{"version":3,"file":"singleton.js","sources":["../src/singleton.ts"],"sourcesContent":["import {\n  type ServiceFactory,\n  type ServiceManager,\n  setServiceManager,\n} from './manager.ts';\n\nclass SingletonService<T extends object> {\n  constructor(readonly value: T) {}\n}\n\nclass SingletonServiceManager<T extends object>\n  implements ServiceManager<SingletonService<T>, T>\n{\n  createService(definition: SingletonService<T>): T {\n    return definition.value;\n  }\n}\n\nconst SINGLETON_SERVICE_MANAGER = new SingletonServiceManager();\nconst SINGLETON_SERVICE_MANAGER_FACTORY = () => SINGLETON_SERVICE_MANAGER;\n\nsetServiceManager(\n  SINGLETON_SERVICE_MANAGER_FACTORY,\n  SingletonService.prototype,\n);\n\nconst Wrappers = new WeakMap<object, SingletonService<object>>();\n\nexport function singleton<T extends object>(value: T): ServiceFactory<T> {\n  let wrapper = Wrappers.get(value);\n\n  if (wrapper === undefined) {\n    wrapper = new SingletonService(value);\n    Wrappers.set(value, wrapper);\n  }\n\n  return wrapper as unknown as ServiceFactory<T>;\n}\n"],"names":["SingletonService","constructor","value","SingletonServiceManager","createService","definition","SINGLETON_SERVICE_MANAGER","SINGLETON_SERVICE_MANAGER_FACTORY","setServiceManager","prototype","Wrappers","WeakMap","singleton","wrapper","get","undefined","set"],"mappings":";;AAMA,MAAMA,gBAAgB,CAAmB;EACvCC,WAAWA,CAAUC,KAAQ,EAAE;IAAA,IAAVA,CAAAA,KAAQ,GAARA,KAAQ,CAAA;AAAG,GAAA;AAClC,CAAA;AAEA,MAAMC,uBAAuB,CAE7B;EACEC,aAAaA,CAACC,UAA+B,EAAK;IAChD,OAAOA,UAAU,CAACH,KAAK,CAAA;AACzB,GAAA;AACF,CAAA;AAEA,MAAMI,yBAAyB,GAAG,IAAIH,uBAAuB,EAAE,CAAA;AAC/D,MAAMI,iCAAiC,GAAGA,MAAMD,yBAAyB,CAAA;AAEzEE,iBAAiB,CACfD,iCAAiC,EACjCP,gBAAgB,CAACS,SACnB,CAAC,CAAA;AAED,MAAMC,QAAQ,GAAG,IAAIC,OAAO,EAAoC,CAAA;AAEzD,SAASC,SAASA,CAAmBV,KAAQ,EAAqB;AACvE,EAAA,IAAIW,OAAO,GAAGH,QAAQ,CAACI,GAAG,CAACZ,KAAK,CAAC,CAAA;EAEjC,IAAIW,OAAO,KAAKE,SAAS,EAAE;AACzBF,IAAAA,OAAO,GAAG,IAAIb,gBAAgB,CAACE,KAAK,CAAC,CAAA;AACrCQ,IAAAA,QAAQ,CAACM,GAAG,CAACd,KAAK,EAAEW,OAAO,CAAC,CAAA;AAC9B,GAAA;AAEA,EAAA,OAAOA,OAAO,CAAA;AAChB;;;;"}
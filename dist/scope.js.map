{"version":3,"file":"scope.js","sources":["../src/scope.ts"],"sourcesContent":["import { getOwner } from '@ember/application';\nimport { assert } from '@ember/debug';\nimport { get } from './utils.ts';\n\nexport interface Scope {}\n\nconst SCOPE = Symbol('service:scope');\n\nexport function setScope(object: object, scope: Scope): void {\n  assert(\n    '`setScope()` has already been called on this object previously',\n    Object.getOwnPropertyDescriptor(object, SCOPE) === undefined,\n  );\n\n  Object.defineProperty(object, SCOPE, {\n    configurable: false,\n    enumerable: false,\n    writable: false,\n    value: scope,\n  });\n}\n\nexport function getScope(object: object): Scope | undefined {\n  return get(object, SCOPE) ?? getOwner(object);\n}\n\nexport function mapFor<K extends object, V>(\n  scope: Scope,\n  maps: WeakMap<Scope, WeakMap<K, V>>,\n): WeakMap<K, V> {\n  let map = maps.get(scope);\n\n  if (map === undefined) {\n    map = new WeakMap();\n    maps.set(scope, map);\n  }\n\n  return map;\n}\n"],"names":["SCOPE","Symbol","setScope","object","scope","assert","Object","getOwnPropertyDescriptor","undefined","defineProperty","configurable","enumerable","writable","value","getScope","get","getOwner","mapFor","maps","map","WeakMap","set"],"mappings":";;;;AAMA,MAAMA,KAAK,GAAGC,MAAM,CAAC,eAAe,CAAC,CAAA;AAE9B,SAASC,QAAQA,CAACC,MAAc,EAAEC,KAAY,EAAQ;AAC3DC,EAAAA,MAAM,CACJ,gEAAgE,EAChEC,MAAM,CAACC,wBAAwB,CAACJ,MAAM,EAAEH,KAAK,CAAC,KAAKQ,SACrD,CAAC,CAAA;AAEDF,EAAAA,MAAM,CAACG,cAAc,CAACN,MAAM,EAAEH,KAAK,EAAE;AACnCU,IAAAA,YAAY,EAAE,KAAK;AACnBC,IAAAA,UAAU,EAAE,KAAK;AACjBC,IAAAA,QAAQ,EAAE,KAAK;AACfC,IAAAA,KAAK,EAAET,KAAAA;AACT,GAAC,CAAC,CAAA;AACJ,CAAA;AAEO,SAASU,QAAQA,CAACX,MAAc,EAAqB;EAC1D,OAAOY,GAAG,CAACZ,MAAM,EAAEH,KAAK,CAAC,IAAIgB,QAAQ,CAACb,MAAM,CAAC,CAAA;AAC/C,CAAA;AAEO,SAASc,MAAMA,CACpBb,KAAY,EACZc,IAAmC,EACpB;AACf,EAAA,IAAIC,GAAG,GAAGD,IAAI,CAACH,GAAG,CAACX,KAAK,CAAC,CAAA;EAEzB,IAAIe,GAAG,KAAKX,SAAS,EAAE;AACrBW,IAAAA,GAAG,GAAG,IAAIC,OAAO,EAAE,CAAA;AACnBF,IAAAA,IAAI,CAACG,GAAG,CAACjB,KAAK,EAAEe,GAAG,CAAC,CAAA;AACtB,GAAA;AAEA,EAAA,OAAOA,GAAG,CAAA;AACZ;;;;"}
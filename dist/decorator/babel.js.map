{"version":3,"file":"babel.js","sources":["../../src/decorator/babel.ts"],"sourcesContent":["import { assert, runInDebug } from '@ember/debug';\nimport { decoratorFor as decoratorForStageThree } from './stage-three.ts';\n\ntype ClassPropertyDescriptor = PropertyDescriptor & {\n  initializer?: () => (...args: unknown[]) => unknown;\n};\n\ntype ClassPropertyDecorator = (\n  target: object,\n  name: string | symbol,\n  descriptor: ClassPropertyDescriptor,\n) => ClassPropertyDescriptor | undefined;\n\nexport type DecoratorArgs = Parameters<ClassPropertyDecorator>;\n\nfunction notImplemented(): never {\n  assert('not implemented');\n}\n\nexport function detect(args: unknown[]): args is DecoratorArgs {\n  if (args.length !== 3) {\n    return false;\n  }\n\n  const [, name, descriptor] = args;\n\n  if (typeof name !== 'string' && typeof name !== 'symbol') {\n    return false;\n  }\n\n  return (\n    descriptor !== null &&\n    typeof descriptor === 'object' &&\n    'configurable' in descriptor &&\n    'enumerable' in descriptor\n  );\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport type ServiceDecorator<T> = ClassPropertyDecorator;\n\ntype ServiceDecoratorReturn<T> = ReturnType<ServiceDecorator<T>>;\n\nexport function decoratorFor<T>(\n  service: (scopable: object, name: string | symbol) => T,\n): ServiceDecorator<T> {\n  const stageThreeDecorator = decoratorForStageThree(service);\n\n  function decorator(...args: DecoratorArgs): ServiceDecoratorReturn<T> {\n    runInDebug(() => {\n      const [target, name, descriptor] = args;\n      const { value, get, set, initializer } = descriptor;\n\n      const isStatic =\n        typeof target === 'function' && /^\\s*class\\s+/.test(target.toString());\n\n      if (typeof value === 'function') {\n        // eslint-disable-next-line @typescript-eslint/ban-types\n        const method = value as Function;\n\n        stageThreeDecorator(method, {\n          kind: 'method',\n          name,\n          access: { get: notImplemented },\n          static: isStatic,\n          private: false,\n          addInitializer: notImplemented,\n        });\n\n        assert('unreachable');\n      }\n\n      if (typeof get === 'function') {\n        stageThreeDecorator(get, {\n          kind: 'getter',\n          name,\n          access: { get: notImplemented },\n          static: isStatic,\n          private: false,\n          addInitializer: notImplemented,\n        });\n\n        assert('unreachable');\n      }\n\n      if (typeof set === 'function') {\n        stageThreeDecorator(set, {\n          kind: 'setter',\n          name,\n          access: { set: notImplemented },\n          static: isStatic,\n          private: false,\n          addInitializer: notImplemented,\n        });\n\n        assert('unreachable');\n      }\n\n      if (typeof initializer === 'function') {\n        const init = stageThreeDecorator(undefined, {\n          kind: 'field',\n          name,\n          access: {\n            get: notImplemented,\n            set: notImplemented,\n          },\n          static: isStatic,\n          private: false,\n        });\n\n        init('nope' as unknown as undefined);\n\n        assert('unreachable');\n      }\n    });\n\n    const [, name, descriptor] = args;\n\n    const access = {\n      get: notImplemented,\n      set: notImplemented,\n    };\n\n    const { get, set } = stageThreeDecorator(access, {\n      kind: 'accessor',\n      name,\n      access,\n      static: false,\n      private: false,\n      addInitializer: notImplemented,\n    });\n\n    const { configurable, enumerable } = descriptor;\n\n    return {\n      configurable,\n      enumerable,\n      get,\n      set,\n    };\n  }\n\n  return decorator;\n}\n"],"names":["notImplemented","assert","detect","args","length","name","descriptor","decoratorFor","service","stageThreeDecorator","decoratorForStageThree","decorator","runInDebug","target","value","get","set","initializer","isStatic","test","toString","method","kind","access","static","private","addInitializer","init","undefined","configurable","enumerable"],"mappings":"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"}